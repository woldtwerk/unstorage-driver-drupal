import{_ as ge}from"./entry.ztxzRjWp.js";import{H,d as F,I as p,D as h,J as N,K,L as W,M as q,O as Q,P as X,j as Z,Q as G,f as T,R as D,i as Y,F as ee,T as te,S as ne,U as se,V as le,W as ae,X as re}from"./entry.oEaghZDR.js";function oe(e=H()){var s;return(s=e.ssrContext)==null?void 0:s.event}const ie={trailing:!0};function ue(e,s=25,a={}){if(a={...ie,...a},!Number.isFinite(s))throw new TypeError("Expected `wait` to be a finite number");let d,u,r=[],o,n;const x=(c,y)=>(o=ce(e,c,y),o.finally(()=>{if(o=null,a.trailing&&n&&!u){const S=x(c,n);return n=null,S}}),o);return function(...c){return o?(a.trailing&&(n=c),o):new Promise(y=>{const S=!u&&a.leading;clearTimeout(u),u=setTimeout(()=>{u=null;const k=a.leading?d:x(this,c);for(const R of r)R(k);r=[]},s),S?(d=x(this,c),y(d)):r.push(y)})}}async function ce(e,s,a){return await e.apply(s,a)}const _="_islandPromises",U=/nuxt-ssr-component-uid="([^"]*)"/,fe=/nuxt-ssr-component-uid(="([^"]*)")?/,de=/nuxt-ssr-slot-name="([^"]*)"/g,ve=/<div nuxt-slot-fallback-start="([^"]*)"[^>]*><\/div>(((?!<div nuxt-slot-fallback-end[^>]*>)[\s\S])*)<div nuxt-slot-fallback-end[^>]*><\/div>/g;let me=0;const L=()=>(me++).toString();function z(){return{chunks:{},props:{},teleports:{}}}const pe=F({name:"NuxtIsland",props:{name:{type:String,required:!0},lazy:Boolean,props:{type:Object,default:()=>{}},context:{type:Object,default:()=>({})},source:{type:String,default:()=>{}},dangerouslyLoadClientComponents:{type:Boolean,default:!1}},async setup(e,{slots:s,expose:a}){var A,O,$,I;const d=p(0),u=h(()=>N),r=p(null),o=re(),n=H(),x=h(()=>e.props?Object.fromEntries(Object.entries(e.props).filter(([l])=>!l.startsWith("data-v-"))):{}),c=h(()=>K([e.name,x.value,e.context,e.source])),y=ne();oe();const S=globalThis.fetch,k=p(!1);W(()=>{k.value=!0});function R(l,t){n.payload.data[l]={__nuxt_island:{key:l,params:{...e.context,props:e.props?JSON.stringify(e.props):void 0},result:{chunks:t.chunks,props:t.props,teleports:t.teleports}},...t}}const b=n.isHydrating?((A=q(n.payload.data))==null?void 0:A[`${e.name}_${c.value}`])??z():z(),w={chunks:b.chunks,props:b.props,teleports:b.teleports},v=p("");v.value=(($=Q(((O=y.vnode)==null?void 0:O.el)??null,!0))==null?void 0:$.join(""))||"";const B=h(()=>X(v.value)),m=p(((I=v.value.match(U))==null?void 0:I[1])??L()),M=h(()=>[...v.value.matchAll(de)].map(l=>l[1])),C=h(()=>{const l=Object.keys(s);let t=v.value;if(!u.value)for(const[i,g]of Object.entries(w.teleports||{}))t=t.replace(new RegExp(`<div [^>]*nuxt-ssr-client="${i}"[^>]*>`),f=>f+g);return t.replace(ve,(i,g,f)=>l.includes(g)?"":f)});function V(){var l;m.value=((l=v.value.match(U))==null?void 0:l[1])??L()}const P=p({link:[],style:[]});Z(P);async function J(l=!1){var j;const t=`${e.name}_${c.value}`;if((j=n.payload.data[t])!=null&&j.html&&!l)return n.payload.data[t];const i=`/__nuxt_island/${t}.json`,f=await(await S(le(e.source?i:ae(o.app.baseURL??"",i),{...e.context,props:e.props?JSON.stringify(e.props):void 0}))).json();return R(t,f),f}async function E(l=!1){n[_]=n[_]||{},n[_][m.value]||(n[_][m.value]=J(l).finally(()=>{delete n[_][m.value]}));try{const t=await n[_][m.value];P.value.link=t.head.link,P.value.style=t.head.style,v.value=t.html.replace(fe,()=>`nuxt-ssr-component-uid="${L()}"`),d.value++,r.value=null,w.teleports=t.teleports,w.chunks=t.chunks,await se(),V()}catch(t){r.value=t}}return a({refresh:()=>E(!0)}),G(e,ue(()=>E(),100)),!n.isHydrating&&e.lazy?E():(!n.isHydrating||!n.payload.serverRendered)&&await E(),()=>{var t;if(!C.value||r.value)return[((t=s.fallback)==null?void 0:t.call(s,{error:r.value}))??T("div")];const l=[T(ee,{key:d.value},[D(Y(C.value||"<div></div>",1))])];if(m.value&&(k.value||n.isHydrating)&&C.value)for(const i in s)M.value.includes(i)&&l.push(T(te,{to:`[nuxt-ssr-component-uid='${m.value}'] [nuxt-ssr-slot-name='${i}']`},{default:()=>(B.value[i]??[void 0]).map(g=>{var f;return(f=s[i])==null?void 0:f.call(s,g)})}));return l}}}),_e=e=>F({name:e,inheritAttrs:!1,props:{lazy:Boolean},setup(s,{attrs:a,slots:d,expose:u}){const r=p(null);return u({refresh:()=>{var o;return(o=r.value)==null?void 0:o.refresh()}}),()=>D(pe,{name:e,lazy:s.lazy,props:a,ref:r},d)}});export{_e as c};
